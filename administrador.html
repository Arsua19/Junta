<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Administrador - Junta de Cobros</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, Timestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCjRpXgMuoPiQK3lphUZ11DSSh5khhUcsE",
      authDomain: "libreta-apuntes.firebaseapp.com",
      projectId: "libreta-apuntes",
      storageBucket: "libreta-apuntes.appspot.com",
      messagingSenderId: "978320562467",
      appId: "1:978320562467:web:de1d158f726bedf893b29c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.getElementById("registroForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const fecha = new Date(document.getElementById("fecha").value);
      const dia = document.getElementById("dia").value;
      const pago = document.getElementById("pago").value === "true";
      const monto = parseFloat(document.getElementById("monto").value);
      const cliente = document.getElementById("cliente").value;

      let diasPagados = pago ? 1 : 0;

      const nuevo = { cliente, fecha, dia, pago, monto, diasPagados };
      await addDoc(collection(db, "registrosCobro"), nuevo);
      alert("Registro guardado");
      location.reload();
    });

    async function cargarDatos() {
      const querySnapshot = await getDocs(collection(db, "registrosCobro"));
      const tabla = document.getElementById("tablaRegistros");
      let sumaMonto = 0;
      let sumaDiasPagados = 0;

      querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const fila = document.createElement("tr");

        const fecha = data.fecha.toDate().toLocaleDateString();
        fila.innerHTML = `
          <td>${data.cliente || "Sin nombre"}</td>
          <td>${fecha}</td>
          <td>${data.dia}</td>
          <td>S/ ${data.monto.toFixed(2)}</td>
          <td>${data.pago ? "Pagado" : "No Pagado"}</td>
          <td>${data.diasPagados}</td>
          <td><button onclick="eliminarRegistro('${docSnap.id}')">Eliminar</button></td>
        `;

        tabla.appendChild(fila);
        sumaMonto += data.monto;
        sumaDiasPagados += data.diasPagados;
      });

      document.getElementById("sumaMonto").textContent = `S/ ${sumaMonto.toFixed(2)}`;
      document.getElementById("sumaDias").textContent = sumaDiasPagados;
    }

    window.eliminarRegistro = async function (id) {
      await deleteDoc(doc(db, "registrosCobro", id));
      alert("Registro eliminado");
      location.reload();
    };

    cargarDatos();
  </script>
</head>
<body>
  <h1>Administrador - Junta de Cobros</h1>
  <form id="registroForm">
    <label>Fecha:</label>
    <input type="date" id="fecha" required><br>

    <label>Día:</label>
    <input type="text" id="dia" required><br>

    <label>Cliente:</label>
    <select id="cliente">
      <option value="Elena">Elena</option>
      <option value="Julio">Julio</option>
      <option value="Sabina">Sabina</option>
    </select><br>

    <label>Monto:</label>
    <input type="number" id="monto" step="0.01" required><br>

    <label>Pago:</label>
    <select id="pago">
      <option value="true">Pagado</option>
      <option value="false">No Pagado</option>
    </select><br>

    <button type="submit">Registrar</button>
  </form>

  <h2>Registros</h2>
  <table border="1">
    <thead>
      <tr>
        <th>Cliente</th>
        <th>Fecha</th>
        <th>Día</th>
        <th>Monto</th>
        <th>Pago</th>
        <th>Días Pagados</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody id="tablaRegistros"></tbody>
  </table>

  <h3>Total Recaudado: <span id="sumaMonto">S/ 0.00</span></h3>
  <h3>Días Pagados: <span id="sumaDias">0</span></h3>
</body>
</html>


