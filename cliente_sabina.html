<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cuenta del Cobranza - Elena</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      padding: 40px;
      text-align: center;
    }
    .contenedor {
      background: white;
      max-width: 800px;
      margin: auto;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      padding: 25px;
    }
    h2 {
      font-size: 24px;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }
    th, td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #ccc;
    }
    thead th {
      background: #004080;
      color: white;
    }
    .resumen {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="contenedor">
    <h2>ðŸ“„ CUENTA DEL COBRANZA - ELENA</h2>

    <table>
      <thead>
        <tr>
          <th>ðŸ“… Fecha</th>
          <th>ðŸ“‹ DÃ­a</th>
          <th>ðŸ’µ Â¿PagÃ³?</th>
          <th>ðŸª™ Monto</th>
          <th>ðŸ“Œ DÃ­as Pagados</th>
        </tr>
      </thead>
      <tbody id="tablaRegistros"></tbody>
    </table>

    <div class="resumen" id="resumenPago"></div>
    <div class="resumen" id="resumenDias"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore, collection, getDocs, query, orderBy, where
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB0Znv0HmW93BXC7oEAXqmDvdYzeRpSBFc",
      authDomain: "junta-e4b33.firebaseapp.com",
      projectId: "junta-e4b33",
      storageBucket: "junta-e4b33.appspot.com",
      messagingSenderId: "1061817924806",
      appId: "1:1061817924806:web:1a0f7712524101ba816bc7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const cliente = "sabina";
    const tarifa = 600;
    const unidad = "mes(es)";


    const tabla = document.getElementById("tablaRegistros");
    const resumenPago = document.getElementById("resumenPago");
    const resumenDias = document.getElementById("resumenDias");

    async function cargarRegistros() {
      let totalPagado = 0;
      let totalUnidades = 0;
      tabla.innerHTML = "";

      const q = query(
        collection(db, "registrosCobro"),
        where("cliente", "==", cliente),
        orderBy("fecha")
      );

      const snapshot = await getDocs(q);
      snapshot.forEach(doc => {
        const data = doc.data();
        const fecha = data.fecha.toDate().toISOString().split("T")[0];
        const monto = parseFloat(data.monto).toFixed(2);
        const unidades = data.pago === "SÃ­" ? (data.diasPagados || 0) : 0;

        totalUnidades += unidades;
        totalPagado += data.pago === "SÃ­" ? parseFloat(monto) : 0;

        const fila = document.createElement("tr");
        fila.innerHTML = `
          <td>${fecha}</td>
          <td>${data.dia}</td>
          <td>${data.pago}</td>
          <td>S/ ${data.pago === "SÃ­" ? monto : "0.00"}</td>
          <td>${unidades}</td>
        `;
        tabla.appendChild(fila);
      });

      resumenPago.textContent = `Total pagado: S/ ${totalPagado.toFixed(2)}`;
      resumenDias.textContent = `Total de ${unidad} pagados: ${totalUnidades}`;
    }

    cargarRegistros();
  </script>
</body>
</html>
